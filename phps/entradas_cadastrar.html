<script type="text/javascript" src="js/jquery.price_format.1.5.js"></script>
<script type="text/javascript">

    $(document).ready(function(){
        var manter =$("input[name=produtomanter]").val();
        if (manter='on') {
            valida_produto ();
            document.forms["form1"].qtd.focus();
        }
        desabilita_campos ();  
        verifica_incluir()
    });    
    
    function valida_produto () {
        verifica_incluir()
        $.post("entradas_valorunitario2.php",{
            produto:$("select[name=produto]").val() , 
            fornecedor:$("select[name=fornecedor]").val() ,
            entrada:$("input[name=entrada2]").val() 
        }, function(valor) {    
            //alert(valor);
            if (valor=="naoestanalista") {                    
                document.forms["form1"].valuni.disabled=false;
                desabilita_campos ();
                //alert('n�o esta na lista');
                $.post("entradas_valorunitario.php",{
                    produto:$("select[name=produto]").val() , 
                    fornecedor:$("select[name=fornecedor]").val() 
                }, function(valor2) {                
                    //alert(valor2);
                    var quebra=valor2.split("|");
                    var valuni=quebra[0];
                    $("input[name=valuni]").val(valuni).priceFormat({prefix: 'R$ ',centsSeparator: ',',thousandsSeparator: '.'}); 
                    $("input[name=valuni2]").val(valuni).priceFormat({prefix: '',centsSeparator: ',',thousandsSeparator: '.'}); 
                    $("input[name=validade]").val("");
                    $("input[name=validade2]").val("");  
                });                     

            } else {                    
                //alert(valor);
                var quebra=valor.split("|");
                var valuni=quebra[0];
                var validade=quebra[1]; 
                if (validade=='00/00/0000') {
                    validade="";
                }
                $("input[name=valuni]").val(valuni).priceFormat({prefix: 'R$ ',centsSeparator: ',',thousandsSeparator: '.'}); 
                $("input[name=valuni2]").val(valuni).priceFormat({prefix: '',centsSeparator: ',',thousandsSeparator: '.'}); 
             
                $("input[name=validade]").val(validade);
                $("input[name=validade2]").val(validade);                
                document.forms["form1"].valuni.disabled=true;
                document.forms["form1"].validade.disabled=true;
                //alert('esta na lista');

            }                
        });          

        $.post("entradas_tipcon.php",{produto:$("select[name=produto]").val()},function(valor){
            $("span[name=tipocontagem]").html(valor);
        });
        

        $.post("entradas_qtdtipcon.php",{produto:$("select[name=produto]").val()},function(valor){
            $("span[name=qtdtipcon]").html(valor);
        }); 

        $("input[name=qtd]").val("");

        desabilita_campos ();        
    }
    
    function desabilita_campos () {
        //alert("entrou");
        var produto= $("select[name=produto]").val();
        if (produto!='') {
            document.forms["form1"].qtd.disabled=false;
            document.forms["form1"].valuni.disabled=false;
            document.forms["form1"].validade.disabled=false;
            document.forms["form1"].local.disabled=false;
            //alert("Habilita");
        }
        else {
            document.forms["form1"].qtd.disabled=true;
            document.forms["form1"].valuni.disabled=true;
            document.forms["form1"].validade.disabled=true;
            document.forms["form1"].validade.value="";
            document.forms["form1"].local.disabled=true;
            //alert("desabilitar");            
        } 
    }

    function verifica_incluir() {
        var valoruni= $("input[name=valuni]").val();
        var quant= $("input[name=qtd]").val(); 
        //alert (quant);
        //alert (valoruni);
        
        if ((valoruni=="")||(valoruni=='R$ 0,00')||(valoruni=='R$ 0,0')||(quant=='0')||(quant=='')||(quant=='0,00')) {
            document.forms["form1"].incluir.disabled=true;            
            //alert('desabilita');
        } else {
            document.forms["form1"].incluir.disabled=false;
            //alert('habilita');
        }  
        
    }


</script>

<link href="js/_style/jquery.click-calendario-1.0.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="js/_scripts/jquery.click-calendario-1.0-min.js"></script>		
<script type="text/javascript" src="js/_scripts/exemplo-calendario.js"></script>
<script type="text/javascript" src="funcoes.js"></script>


<table summary="" class="tabela1" border="0">
    <tr>
        <td width="35px"><img width="50px" src="{ICONES_CAMINHO}entradas.png" alt="" ></td>
        <td valign="bottom">
            <label class="titulo" > ENTRADAS </label><br />
            <label class="subtitulo"> {SUBTITULO} </label>
        </td>
    </tr>
</table>
<hr align="left" class="linhacurta" >
<br />

<form action="entradas_cadastrar.php" method="post" name="form1">
    <table summary="" border="0" class="tabela1" cellpadding="4">
        <!--  BEGIN BLOCK_SELECT_ENTRADA -->
        <tr>
            <td align="right" width="200px"><b>Entrada:<label class="obrigatorio"></label></b></td>
            <td><input type="text" size="8" required name="entrada_codigo" class="campo1" disabled value="{ENTRADA}"> </td>
        </tr>
        <!--  END BLOCK_SELECT_ENTRADA -->
        <!--  BEGIN BLOCK_SELECT_TIPOPESSOA -->
        <tr>
            <td align="right" width="200px"><b>Tipo de Pessoa: <label class="obrigatorio"></label></b></td>
            <td>
                <select autofocus="" name="tipopessoa" class="campo1" {SELECT_TIPOPESSOA_OBRIGATORIO} {SELECT_TIPOPESSOA_DESABILITADO} onchange="popula_fornecedores(this.value);">
                        <option value="">Todos</option>	
                    <!--  BEGIN BLOCK_OPTIONS_TIPOPESSOA -->
                    <option value="{OPTION_TIPOPESSOA_VALOR}" {OPTION_TIPOPESSOA_SELECIONADO} >{OPTION_TIPOPESSOA_TEXTO}</option>
                    <!--  END BLOCK_OPTIONS_TIPOPESSOA -->
                </select>
                <input type="hidden" name="tipopessoa2" value="{TIPOPESSOA}">
            </td>            
        </tr>
        <!--  END BLOCK_SELECT_TIPOPESSOA -->
        <!--  BEGIN BLOCK_SELECT_FORNECEDOR -->
        <tr>
            <td align="right" width="200px"><b>Fornecedor: <label class="obrigatorio"></label></b></td>
            <td>
                <select autofocus="1" name="fornecedor" class="campo1" {SELECT_OBRIGATORIO} {SELECT_DESABILITADO} >
                        <option value="">Selecione</option>	
                    <!--  BEGIN BLOCK_OPTIONS_FORNECEDOR -->
                    <option value="{OPTION_VALOR}" {OPTION_SELECIONADO} >{OPTION_TEXTO}</option>
                    <!--  END BLOCK_OPTIONS_FORNECEDOR -->
                </select>
                <input type="hidden" name="fornecedor2" value="{FORNECEDOR}">
            </td>            
        </tr>
        <!--  END BLOCK_SELECT_FORNECEDOR -->
        <!--  BEGIN BLOCK_SUPERVISOR -->
        <tr>
            <td align="right" width="200px"><b>Supervisor: <label class="obrigatorio"></label></b></td>
            <td>
                <select autofocus="1" name="fornecedor" class="campo1"  {SELECT_OBRIGATORIO} {SELECT_DESABILITADO} >
                        <option value="">Selecione</option>	
                    <!--  BEGIN BLOCK_OPTIONS_SUPERVISOR -->
                    <option value="{OPTION_VALOR}" {OPTION_SELECIONADO} >{OPTION_TEXTO}</option>
                    <!--  END BLOCK_OPTIONS_SUPERVISOR -->
                </select>                
            </td>

        </tr>
        <!--  END BLOCK_SUPERVISOR -->      

        <!--  BEGIN BLOCK_DATAHORA -->
        <tr>
            <td align="right"><b>Data: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="8" required name="data1" class="campo1" disabled value="{ENTRADAS_DATA}"> </td>
        </tr>    
        <tr>
            <td align="right"><b>Hora: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="8" required name="hora1" class="campo1" disabled value="{ENTRADAS_HORA}"></td>
        </tr> 
        <!--  END BLOCK_DATAHORA -->      


        <!--  BEGIN BLOCK_BOTAO_PASSO1 -->
        <tr>
            <td>&nbsp;</td>
            <td>
                <input type="hidden" name="passo" value="2">
                <input type="submit" value="CONTINUAR" class="botao fonte3">
            </td>
        </tr>
        <!--  END BLOCK_BOTAO_PASSO1 -->

        <!-- Ap�s a gera��o da entrada � necess�rio enviar o codigo da entrada novamente para o php   -->
        <input type="hidden" name="entrada" value="{ENTRADA}">

        <!--  BEGIN BLOCK_PASSO2 -->
        <tr>
            <td align="right" width="200px"><b>Produto: <label class="obrigatorio"></label></b></td>
            <td>
                <select autofocus="2" name="produto" onchange=" valida_produto()"   id="{SELECT2_NOME}" class="campo1" {SELECT2_OBRIGATORIO} {SELECT2_DESABILITADO} >
                        <option value="">Selecione</option>	
                    <!--  BEGIN BLOCK_OPTIONS_PRODUTO -->
                    <option value="{OPTION2_VALOR}" {OPTION2_SELECIONADO} >{OPTION2_TEXTO}</option>
                    <!--  END BLOCK_OPTIONS_PRODUTO -->
                </select>
                <input type="checkbox" name="produtomanter" {PRODUTOMANTER_HABILITADO}> <span>Manter</span>
            </td>
        </tr>
        <tr>
            <td align="right"><b>Quantidade: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="8" required name="qtd" id="qtd" onclick="this.select()"  onkeyup="mascara_pesoqtd()" class="campo1" autocomplete="off" >&nbsp;<span name="tipocontagem" class="fonte1"></span></td>
        </tr>
        <tr>
            <td align="right"><b>Valor Unitário: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="8" required name="valuni" class="campo1" autocomplete="off" onclick="this.select()" onkeyup="verifica_incluir()" >&nbsp;<span name="qtdtipcon" class="fonte1" autocomplete="off" ></span></td>
        </tr>
        <tr>
            <td align="right"><b>Validade: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="10" maxlength="10" name="validade" id="data_1" class="campo1"  onclick="this.select()" >
        </tr>
        <tr>
            <td align="right"><b>Local/Prateleira: <label class="obrigatorio"></label></b></td>
            <td><input type="text" size="25" maxlength="" name="local" id="local" class="campo1"  onclick="this.select()" >
        </tr>

        <!--  BEGIN BLOCK_BOTAO_PASSO2 -->
        <tr>
            <td>&nbsp;</td>
            <td>
                <input type="hidden" name="passo" value="3">
                <input type="submit" id="incluir" name="incluir" value="INCLUIR PRODUTO" class="botao fonte3" >
            </td>
        </tr>
        <!--  END BLOCK_BOTAO_PASSO2 -->
        <!--  END BLOCK_PASSO2 -->
    </table>

    <!--  BEGIN BLOCK_ENTER -->
    </br>
    <!--  END BLOCK_ENTER -->

    <!--  BEGIN BLOCK_PASSO3 -->
    <table border="1" class="tabela1" cellpadding="4" width="100%">
        <tr valign="middle" class="tabelacabecalho1">
            <td width="">Nº</td>
            <td width="150px">PRODUTOS</td>
            <td width="" align="center" colspan="2">QUANTIDADE</td>	
            <td width="" align="center">VALOR UNIT.</td>
            <td width="100px">LOCAL</td>
            <td width="" align="center">VALIDADE</td>
            <td width="" align="center">VALOR TOTAL</td>	
            <!--  BEGIN BLOCK_CABECALHO_OPERACAO -->
            <td width="70px" colspan="{OPER_COLSPAN}">OPER.</td>
            <!--  END BLOCK_CABECALHO_OPERACAO -->
        </tr>

        <!--  BEGIN BLOCK_LISTA -->
        <tr class="lin">
            <td>{ENTRADAS_NUMERO}</td>
            <td>{ENTRADAS_PRODUTO_NOME}</td>
            <td align="right">{ENTRADAS_QTD}</td>
            <td align="left">{SIGLA}</td>
            <td align="right">{ENTRADAS_VALORUNI}</td>
            <td>{ENTRADAS_LOCAL}</td>
            <td align="right">{ENTRADAS_VALIDADE}</td>
            <td align="right">{ENTRADAS_VALOR_TOTAL}</td>
            <!--  BEGIN BLOCK_LISTA_OPERACAO -->
            <!--  BEGIN BLOCK_LISTA_OPERACAO_ETIQUETAS -->
            <td align="center" class="fundo1"> 
                <a href="{IMPRIMIR_LINK}" target="_blank" class="link1">
                    <img  width="18px"  src="{IMPRIMIR}"  title="Imprimir Etiqueta" alt="Imprimir Etiqueta" />
                </a>
            </td>
            <!--  END BLOCK_LISTA_OPERACAO_ETIQUETAS -->
            <!--  BEGIN BLOCK_LISTA_OPERACAO_EXCLUIR -->
            <td align="center" class="fundo1">
                <a href="entradas_cadastrar.php?fornecedor={FORNECEDOR}&cancelar=1&passo=3&entrada={ENTRADA}&produto={PRODUTO}&item_numero={ENTRADAS_NUMERO}" class="link1">
                    <img  width="18px"  src="{ICONES_CAMINHO}remover.png"  title="Remover" alt="Remover" />
                </a>
            </td>
            <!--  END BLOCK_LISTA_OPERACAO_EXCLUIR -->
            <!--  END BLOCK_LISTA_OPERACAO -->        
        </tr>
        <!--  END BLOCK_LISTA -->

        <!--  BEGIN BLOCK_LISTA_NADA -->
        <tr><td colspan="11" align="center" class="errado">Nenhum produto na lista!</td></tr>
        <!--  END BLOCK_LISTA_NADA -->
        <tr class="tabelarodape1">
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td align="right">{TOTAL_ENTRADA}</td>
            <!--  BEGIN BLOCK_LISTA_NADA_OPERACAO -->            
            <td> </td>
            <!--  END BLOCK_LISTA_NADA_OPERACAO -->
        </tr>

    </table>
    <br>
    
    <!-- BEGIN BLOCK_HR -->
    <hr >
    <!-- END BLOCK_HR -->
    
    <input type="hidden" name="entrada2" value="{ENTRADA}">
    <!-- este valor � alimentado pelo javascript, � necess�rio para quando h� mais de um produto na lista de produtos porque o campo fica desabilitado-->
    <input type="hidden" name="valuni2" id="valuni2" value="">
    <input type="hidden" name="validade2" id="validade2" value="">

    <!-- BEGIN BLOCK_BOTOES -->
    <table border="0">
        <tr class="">
            <td width="100%" align="left">
                <a class="link" href="entradas_cancelar.php?codigo={ENTRADA}">
                    <input type="button" class="botao botaovermelho fonte3" value="ELIMINAR ENTRADA">
                </a>    
            </td>
            <td>
                <a class="link" href="entradas.php">
                    <input type="button" class="botao fonte3" value="{INTERROMPER}">
                </a>        
            </td>
            <td>
                <a class="link" href="entradas_cadastrar2.php?salvar=1&entrada={ENTRADA}&operacao={OPERACAO}">
                    <input type="button" 
                           {SALVAR_DESABILIDADO}
                           class="botao fonte3"
                           value="FINALIZAR ENTRADA"
                    >
                </a>
            </td>
        </tr>
    </table>
    <!-- END BLOCK_BOTOES -->
    
    
    <!-- BEGIN BLOCK_BOTAO_VOLTAR -->
    <a class="link" href="javascript:window.history.go(-1)"><input type="button" value="VOLTAR" class="botao fonte3" autofocus="1"></a>    
    <!-- END BLOCK_BOTAO_VOLTAR -->
    
    <!-- BEGIN BLOCK_BOTAO_IMPRIMIR -->
    <a class="link" href="entradas_imprimir.php?codigo={ENTRADA}" target="_blank">
        <input type="button" value="IMPRIMIR" class="botao fonte3">
    </a>    
    <!-- END BLOCK_BOTAO_IMPRIMIR -->




    <!--  END BLOCK_PASSO3 -->

    <script type="text/javascript">
        {IRPARA}
    </script>
</form>

